<toolkit:DialogWindow x:Class="NeopilotVS.RefactorCodeDialogWindow" x:Name="RefactorCodeDialogWindow_"
                        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                        xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.17.0"
                        xmlns:platform="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.17.0"
                        xmlns:toolkit="clr-namespace:Community.VisualStudio.Toolkit;assembly=Community.VisualStudio.Toolkit"
                        xmlns:imaging="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.Imaging"
                        xmlns:imagecatalog="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.ImageCatalog"

                        WindowStyle="None"
                        ResizeMode="NoResize"
                        AllowsTransparency="True"
                        mc:Ignorable="d"

                        Title="Neopilot Refactor"
                        WindowStartupLocation="CenterOwner"

                        Width="500"
                        Height="550"
                        
                        MouseLeftButtonDown="Window_MouseLeftButtonDown"
                        PreviewKeyDown="Window_PreviewKeyDown"
                        Background="Transparent"
                        >

    <toolkit:DialogWindow.Resources>
        <ResourceDictionary>
            
            <Style x:Key="ModernButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="bg" Background="{TemplateBinding Background}" CornerRadius="4" Margin="2,1">
                                <ContentPresenter VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bg" Property="Background" Value="{DynamicResource {x:Static platform:EnvironmentColors.ButtonHoverBrushKey}}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="bg" Property="Background" Value="{DynamicResource {x:Static platform:EnvironmentColors.ButtonPressedBrushKey}}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="ActionButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource {x:Static platform:EnvironmentColors.ButtonDefaultBrushKey}}"/>
                <Setter Property="Foreground" Value="{DynamicResource {x:Static platform:EnvironmentColors.ButtonDefaultTextBrushKey}}"/>
                <Setter Property="Padding" Value="10,5"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="bg" Background="{TemplateBinding Background}" CornerRadius="4" BorderThickness="1" BorderBrush="{DynamicResource {x:Static platform:EnvironmentColors.ButtonBorderBrushKey}}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bg" Property="Background" Value="{DynamicResource {x:Static platform:EnvironmentColors.ButtonHoverBrushKey}}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </platform:DialogWindow.Resources>

    <Border CornerRadius="8" BorderThickness="1" Background="{DynamicResource {x:Static platform:EnvironmentColors.ComboBoxListBackgroundBrushKey}}" BorderBrush="{DynamicResource {x:Static platform:EnvironmentColors.ComboBoxBorderBrushKey}}">
        <Grid Margin="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header / Title Bar Area -->
            <Grid Grid.Row="0" Margin="15,15,15,10">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <imaging:CrispImage Moniker="{x:Static imagecatalog:KnownMonikers.MagicWand}" Width="18" Height="18" Margin="0,0,8,0"/>
                    <TextBlock Text="Refactor with Neopilot" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                </StackPanel>
                <Button HorizontalAlignment="Right" Style="{StaticResource ModernButtonStyle}" Padding="5" Click="CloseButton_Click">
                    <imaging:CrispImage Moniker="{x:Static imagecatalog:KnownMonikers.Close}" Width="14" Height="14"/>
                </Button>
            </Grid>

            <!-- Input Area -->
            <Grid Grid.Row="1" Margin="15,5">
                <Border CornerRadius="6" BorderThickness="1" BorderBrush="{DynamicResource {x:Static platform:EnvironmentColors.TextBoxBorderBrushKey}}" Background="{DynamicResource {x:Static platform:EnvironmentColors.TextBoxBackgroundBrushKey}}">
                    <Grid>
                        <TextBox x:Name="InputPrompt" 
                                 Background="Transparent" 
                                 BorderThickness="0" 
                                 Padding="10,8,40,8" 
                                 FontSize="14"
                                 VerticalContentAlignment="Center"
                                 KeyDown="InputPrompt_KeyDown" 
                                 TextChanged="InputPrompt_TextChanged"
                                 CaretBrush="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}"/>
                        
                        <TextBlock x:Name="InputPromptHint" 
                                   IsHitTestVisible="False" 
                                   Text="Describe your refactor or select a preset..." Margin="13,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource {x:Static platform:EnvironmentColors.TextBoxTextDisabledBrushKey}}" 
                                   FontSize="13" 
                                   FontStyle="Italic"/>

                        <Button HorizontalAlignment="Right" Margin="0,0,5,0" Style="{StaticResource ModernButtonStyle}" Padding="5" Click="SendButton_Click">
                            <imaging:CrispImage Moniker="{x:Static imagecatalog:KnownMonikers.Send}" Width="16" Height="16"/>
                        </Button>
                    </Grid>
                </Border>
            </Grid>

            <!-- Presets Area -->
            <ScrollViewer Grid.Row="2" Margin="10,10,10,15" VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="PresetsPanel" Margin="5">
                    <TextBlock Text="PRESETS" FontSize="10" FontWeight="Bold" Margin="6,0,0,8" Foreground="{DynamicResource {x:Static platform:EnvironmentColors.TextBoxTextDisabledBrushKey}}" Opacity="0.7"/>
                    <!-- Presets will be injected here -->
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Border>
</platform:DialogWindow>
